# Tag Format to Identify Virtual Resource:
#
# [BUILD_ID]-[CATEGORY]-[INSTANCE_NUMBER]-[SOFTWARE_NAME]
#
Vagrant.configure("2") do |config|
  <% host_list.each do |instance_number, instance_attrs| %>
  config.vm.define :aws-vm<%= instance_number.to_s %> do |aws|
    aws.vm.box = "dummy"

    aws.vm.provider :aws do |aws, override|
      aws.access_key_id     = "<%= aws_settings[:access_key] %>"
      aws.secret_access_key = "<%= aws_settings[:secret_key] %>"
      aws.keypair_name      = "<%= aws_settings[:ssh_key_name] %>"
      aws.region            = "<%= aws_settings[:default_region] %>"
      aws.instance_type     = "m1.large"
      aws.tags              = { "ID" => "<%= host_list[instance_number]["instance_id"] %>"}

      override.ssh.username         = "<%= aws_settings[:ssh_username] %>"
      override.ssh.private_key_path = "<%= aws_settings[:ssh_priv_key_path] %>"
    end
  end
  <% end %>
end
